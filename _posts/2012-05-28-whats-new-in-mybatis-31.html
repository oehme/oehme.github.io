---
layout: post
title: What's new in mybatis 3.1
date: '2012-05-28T14:24:00.001+02:00'
author: Stefan Oehme
tags: 
modified_time: '2012-05-28T18:28:53.574+02:00'
blogger_id: tag:blogger.com,1999:blog-7973028861743150658.post-6372615239474158276
blogger_orig_url: http://mnmlst-dvlpr.blogspot.com/2012/05/whats-new-in-mybatis-31.html
---

The latest <a href="http://code.google.com/p/mybatis/">mybatis release 3.1.1</a> brings a lot of cool new features and important bug fixes. I'd like to point out some of the most interesting ones which I have personally been looking forward to:<br /><div><br /></div><div><h4> Multi DB vendor support</h4><div>You can now write different versions of the same query for multiple database vendors. Thus you no longer need to change all the code when a new database is to be used. To do so you just write several mapper statements of the same name, but with different "databaseId" attribute.&nbsp;You can also configure the way in which mybatis finds out which database it is currently talking to by registering your own DataBaseIdProvider.&nbsp;</div><div>This only works for XML-based mappers, though.</div></div><div><br /></div><h4> Auto discovery</h4><div>Mybatis can now automatically search packages not only for mappers, but also for type handlers and type aliases. This is especially useful in component based applications where each component wants to add its own type handlers. With auto discovery you no longer have to make a&nbsp;specialized&nbsp;database module for each component. Instead you just make a convention to put all type handlers in a certain package.</div><div>Type aliases are marked by the @Alias annotation. Type handlers are marked by @MappedTypes</div><div><br /></div><h4> Reduced scope of local session cache</h4><div>The local session cache is used to avoid loops in nested selects. But it can also lead to subtle bugs where it returns instances which have changed in the meantime. To get around this, its scope can now be reduced to "per statement" in the configuration. This should be a no-brainer option for most projects!</div><div><br /></div><h4> Support for Oracle generated keys</h4><div>Oracle likes to be different from everyone else for no good reason. It seems to be the only vendor that does not properly support JDBC3 auto generated keys. Mybatis is now able to work around this by querying generated keys by row index. Querying them by column name does not work on Oracle return resultsets. All you need to do is to specify the name of the key column and mybatis will figure out the index.</div><div><br /></div><h4> Generic return types</h4><div>Annotation based mappers can now return generic types like Map&lt;String, Object&gt;, reducing the need for casting and compiler warnings in client code. Also, mybatis now supports not only List and Map, but different kinds of Sets and Arrays as return types.</div><div><br /></div><h4> Improved performance</h4><div>The handling of resultsets has been improved and will now cache things like column names, property mappings and type handlers. This is a very noticeable change on large result sets like the ones I'm used to in my current project (between 60K and 1M rows).</div><div><br /></div><h3> What I'm still missing</h3><h4> </h4><h4> ResultHandlers on annotation mappers</h4><div>I'd really love to be able to use result handlers with annotation based mappers. Currently this is not possible as mybatis has no way of telling the correct type to be instantiated. This is because the method return type has to be void when using a ResultHandler.&nbsp;</div><div>To fix this, either the ResultHandler interface would need to be generic or a new return type annotation would be necessary. I would prefer the former as then I would also no longer need to cast the result object to the correct type.</div><div><br /></div><h4> Compound Types</h4><div>Compound types are types where several database columns are mapped onto a single Java property. Take for instance a financial transaction which contains a Money object that consists of an amount and a currency. In order to make the database searchable it would be a good idea to store amount and currency in different columns. But on the java side, I would want to have them combined into one object.&nbsp;</div>